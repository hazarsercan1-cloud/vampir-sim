<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini Vampir Sim</title>
  <style>
    html, body { height: 100%; margin: 0; background:#0b0b10; color:#e8e8f0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; }
    #wrap { display:flex; gap:12px; padding:12px; box-sizing:border-box; }
    #hud { width: 280px; max-width: 35vw; }
    #card { background:#12131a; border:1px solid #1f2230; border-radius:16px; padding:12px; box-shadow: 0 6px 20px rgba(0,0,0,.35); }
    h1 { font-size:18px; margin:6px 0 10px; }
    .muted { color:#b8b8c8; font-size:12px; line-height:1.4; }
    .row { display:flex; align-items:center; justify-content:space-between; margin:6px 0; font-size:14px; }
    .bar { height:10px; background:#232637; border-radius:999px; overflow:hidden; border:1px solid #2d3147; }
    .fill { height:100%; background:linear-gradient(90deg,#ff3b3b,#a8002b); }
    button { width:100%; margin-top:8px; background:#1b1e2c; color:#e8e8f0; border:1px solid #2a2e45; border-radius:12px; padding:10px 12px; cursor:pointer; }
    button:hover { filter:brightness(1.1); }
    canvas { flex:1; border-radius:14px; background:#0f1119; border:1px solid #1c2033; box-shadow: inset 0 0 120px rgba(0,0,0,.4); }
    .small { font-size:11px; color:#9aa0b3; }
  </style>
</head>
<body>
  <div id="wrap">
    <div id="hud">
      <div id="card">
        <h1>🧛 Mini Vampir Sim</h1>
        <div class="muted">Küçük bir tek-dosya oyun. Gece insanlardan <b>kan</b> topla, gündüz <b>gölge</b>lerde saklan. <b>3 gün</b> hayatta kal!</div>
        <div class="row"><span>Gün:</span><b id="day">1</b></div>
        <div class="row"><span>Vakit:</span><b id="time">Gece</b></div>
        <div class="row"><span>Kan:</span><span style="width:58%" class="bar"><span id="bloodFill" class="fill" style="width:80%"></span></span><b id="blood">80</b></div>
        <div class="row"><span>İnsanlar:</span><b id="humans">0</b></div>
        <div class="muted" style="margin-top:8px">
          <b>Kontroller</b><br/>
          WASD/Hareket · <b>E</b>: Isır · <b>Boşluk</b>: Sıçra (kan harcar)
        </div>
        <button id="restart">Yeniden Başlat</button>
        <div class="small" style="margin-top:6px">"Vampire Survivors" gibi değil; mini bir <i>vampir rol</i> prototipi.</div>
      </div>
    </div>
    <canvas id="game" width="900" height="600"></canvas>
  </div>

  <script>
  // ---- Mini Vampir Sim - tek dosya, ~250 satır ----
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');
  const ui = {
    day: document.getElementById('day'),
    time: document.getElementById('time'),
    blood: document.getElementById('blood'),
    bloodFill: document.getElementById('bloodFill'),
    humans: document.getElementById('humans'),
    restart: document.getElementById('restart'),
  };

  // World settings
  const W = cvs.width, H = cvs.height;
  const DAY_SEC = 40; // bir gün: 40 sn (20 sn gece + 20 sn gündüz)
  const NIGHT_RATIO = 0.55; // günün %55'i gece
  const TARGET_DAYS = 3; // kazanma koşulu
  const RNG = (a,b)=>Math.random()*(b-a)+a;

  const state = {
    t: 0,
    day: 1,
    isNight: true,
    blood: 80,
    alive: true,
    win: false,
    player: { x: W*0.5, y: H*0.5, r: 10, vx:0, vy:0, speed: 150, inv:0 },
    humans: [],
    shadows: [],
    bites: 0,
  };

  function reset() {
    state.t = 0; state.day = 1; state.isNight = true; state.blood = 80; state.alive = true; state.win=false; state.bites=0;
    state.player.x = W*0.5; state.player.y = H*0.5; state.player.vx=0; state.player.vy=0; state.player.inv=0;
    // Gölge bölgeleri (ağaç kümeleri/evler gibi)
    state.shadows = [
      {x:80,y:80,w:180,h:90},
      {x:650,y:70,w:180,h:120},
      {x:120,y:420,w:220,h:110},
      {x:560,y:360,w:260,h:160},
    ];
    // İnsanlar
    state.humans = [];
    for (let i=0;i<10;i++) state.humans.push(makeHuman());
    updateUI();
  }

  function makeHuman(){
    const x = RNG(40,W-40), y = RNG(40,H-40);
    const speed = RNG(35,55);
    return { x, y, r:8, dir:RNG(0,Math.PI*2), speed, panic:0, alive:true, cooldown:0 };
  }

  // Input
  const keys = {};
  window.addEventListener('keydown', e=>{ keys[e.key.toLowerCase()] = true; });
  window.addEventListener('keyup', e=>{ keys[e.key.toLowerCase()] = false; });

  ui.restart.onclick = ()=> reset();

  // Helpers
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const dist=(a,b)=>Math.hypot(a.x-b.x,a.y-b.y);
  function inShadow(x,y){
    for(const s of state.shadows){ if(x>s.x && x<s.x+s.w && y>s.y && y<s.y+s.h) return true; }
    return false;
  }

  function step(dt){
    if(!state.alive || state.win) return;

    // ----- Zaman & gece/gündüz -----
    state.t += dt;
    const cycle = state.t % DAY_SEC; // 0..DAY_SEC
    const nightDur = DAY_SEC * NIGHT_RATIO;
    state.isNight = cycle < nightDur;
    if (state.t >= state.day*DAY_SEC) { // yeni gün
      state.day++;
      if(state.day>TARGET_DAYS){ state.win=true; }
    }

    // ----- Kan tüketimi -----
    const baseDrain = state.isNight ? 2.0 : 3.0; // saniyede
    const sunPenalty = (!state.isNight && !inShadow(state.player.x,state.player.y)) ? 8.0 : 0.0;
    state.blood -= (baseDrain + sunPenalty) * dt;
    if(state.player.inv>0) state.player.inv -= dt;

    // ----- Hareket -----
    const p = state.player;
    let ax = 0, ay = 0;
    if(keys['w']) ay -= 1;
    if(keys['s']) ay += 1;
    if(keys['a']) ax -= 1;
    if(keys['d']) ax += 1;
    if(ax||ay){ const m = Math.hypot(ax,ay); ax/=m; ay/=m; }
    p.vx = ax * p.speed; p.vy = ay * p.speed;

    // Sıçra (dash) - Space
    if(keys[' '] && state.blood>10){
      const dashV = 420; p.x += ax * dashV * dt; p.y += ay * dashV * dt; state.blood -= 18*dt; // basılı tutma maliyeti
    }

    p.x = clamp(p.x + p.vx*dt, 10, W-10);
    p.y = clamp(p.y + p.vy*dt, 10, H-10);

    // ----- İnsanlar AI -----
    for(const h of state.humans){
      if(!h.alive) continue;
      // panik: gece vampir yakınsa kaçar, gündüz gölgeye kaçar
      let targetDir = h.dir;
      if(state.isNight && dist(h, p) < 120){
        targetDir = Math.atan2(h.y - p.y, h.x - p.x); // kaçış
        h.panic = 1.0;
      } else if(!state.isNight && !inShadow(h.x,h.y)){
        // en yakın gölge merkezine yönel
        let best = null, bd = 1e9;
        for(const s of state.shadows){
          const cx = s.x+s.w/2, cy=s.y+s.h/2; const d=Math.hypot(cx-h.x, cy-h.y);
          if(d<bd){ bd=d; best={cx,cy}; }
        }
        if(best) targetDir = Math.atan2(best.cy - h.y, best.cx - h.x);
        h.panic = 0.4;
      } else {
        h.panic = Math.max(0, h.panic - dt*0.5);
        // hafif dolaşma
        if(Math.random()<0.01) targetDir += RNG(-0.7,0.7);
      }
      // yumuşak dönüş
      const dAng = ((targetDir - h.dir + Math.PI*3)%(Math.PI*2))-Math.PI;
      h.dir += clamp(dAng, -1.5*dt, 1.5*dt);

      // hız
      const spd = h.speed * (0.7 + h.panic*0.8);
      h.x = clamp(h.x + Math.cos(h.dir)*spd*dt, 8, W-8);
      h.y = clamp(h.y + Math.sin(h.dir)*spd*dt, 8, H-8);

      if(h.cooldown>0) h.cooldown -= dt;
    }

    // ----- Isırma (E) sadece gece -----
    if(keys['e'] && state.isNight){
      for(const h of state.humans){
        if(!h.alive || h.cooldown>0) continue;
        if(dist(h, state.player) < 22){
          h.alive = false; state.blood = Math.min(100, state.blood + 35); state.bites++; break;
        }
      }
    }

    // ----- Ölüm kontrolleri -----
    if(state.blood <= 0){ state.alive=false; }

    updateUI();
  }

  function updateUI(){
    ui.day.textContent = state.day;
    ui.time.textContent = state.isNight ? 'Gece' : 'Gündüz';
    ui.blood.textContent = Math.max(0, state.blood|0);
    ui.bloodFill.style.width = clamp(state.blood,0,100) + '%';
    ui.humans.textContent = state.humans.filter(h=>h.alive).length;
  }

  function draw(){
    // Arkaplan (dairesel hafif vinyet)
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle = state.isNight ? '#0d0f18' : '#1a1f2d';
    ctx.fillRect(0,0,W,H);

    // Güneş/ay ışığı
    const cycle = (state.t % DAY_SEC)/DAY_SEC; // 0..1
    const light = state.isNight ? 0.15 : 0.55;
    ctx.globalAlpha = light; ctx.fillStyle = '#ffe69a';
    const sunX = W * cycle, sunY = 60 + Math.sin(cycle*Math.PI)*20;
    if(!state.isNight){ ctx.beginPath(); ctx.arc(sunX, sunY, 26, 0, Math.PI*2); ctx.fill(); }
    ctx.globalAlpha = 1;

    // Gölge bölgeleri
    for(const s of state.shadows){
      ctx.fillStyle = state.isNight ? '#0b0d14' : '#0b0d14';
      ctx.strokeStyle = '#1e2234';
      ctx.lineWidth = 2;
      ctx.fillRect(s.x,s.y,s.w,s.h);
      ctx.strokeRect(s.x+0.5,s.y+0.5,s.w-1,s.h-1);
      // Gündüz aydınlıkta hafif gölge vurgusu
      if(!state.isNight){ ctx.globalAlpha = 0.06; ctx.fillStyle = '#000'; ctx.fillRect(s.x-6,s.y-6,s.w+12,s.h+12); ctx.globalAlpha=1; }
    }

    // İnsanlar
    for(const h of state.humans){
      ctx.globalAlpha = h.alive ? 1 : 0.35;
      ctx.beginPath();
      ctx.fillStyle = h.alive ? '#d6f6ff' : '#6d2b2b';
      ctx.arc(h.x, h.y, h.r, 0, Math.PI*2);
      ctx.fill();
      ctx.globalAlpha = 1;
    }

    // Oyuncu (vampir)
    const p = state.player;
    ctx.save();
    ctx.translate(p.x,p.y);
    // aura
    const aura = state.isNight ? 0.25 : 0.12;
    ctx.globalAlpha=aura; ctx.beginPath(); ctx.fillStyle='#9d0028'; ctx.arc(0,0,22,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1;
    // gövde
    ctx.beginPath(); ctx.fillStyle = '#ff2745'; ctx.arc(0,0,p.r,0,Math.PI*2); ctx.fill();
    // dişler
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(-4, -2, 2, 4); ctx.fillRect(2, -2, 2, 4);
    ctx.restore();

    // UI mesajları
    ctx.font = '14px system-ui,Segoe UI,Roboto';
    ctx.fillStyle = '#b8c0d0';
    ctx.fillText(state.isNight? 'Gece: İnsan avı serbest (E ile ısır).': 'Gündüz: Gölge dışında güneş yakar!', 14, 22);

    if(!state.alive){
      banner('🩸 Öldün! Gün: '+state.day+'  Isırık: '+state.bites+'  —  Yeniden başlat için sol menü.');
    }
    if(state.win){
      banner('🏆 Kazandın! '+TARGET_DAYS+' gün hayatta kaldın. Isırık: '+state.bites);
    }
  }

  function banner(text){
    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.fillRect(0, H/2-40, W, 80);
    ctx.font = 'bold 22px system-ui,Segoe UI,Roboto';
    ctx.textAlign='center';
    ctx.fillStyle = '#fff';
    ctx.fillText(text, W/2, H/2+8);
    ctx.restore();
  }

  // Main loop
  let last=performance.now();
  function loop(now){
    const dt = Math.min(0.033, (now-last)/1000); // 33 ms sınırlama
    last = now;
    step(dt);
    draw();
    requestAnimationFrame(loop);
  }

  reset();
  requestAnimationFrame(loop);
  </script>
</body>
</html>
